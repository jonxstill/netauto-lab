# Data Models

## Infrastructure

Basic autogenerated data model for an eBGP-based leaf/spine fabric.

Spines all use same ASN.  Each Leaf has a unique ASN (ASN would be shared between MLAG peers in real-life, but this is the lab...)

infra-dm.yml defines the parameters of the fabric:

* maxspines: Maximum number of spines ever - so we don't end-up readdresing links if we add spines.
* spines: Number of spines in fabric.
* leaves: Number of leaves in fabric.
* baseasn: Base ASN - also spine ASN.
* p2plength: Prefix-length for point-to-point links - typically 31 or 30.
* loopbackprefix: Subnet (in CIDR notation) from which to allocate loopback IPs.  Leaves start at bottom, Spines at top.
* loopbackint: Loopback interface number.
* p2pprefix: Subnet (in CIDR notation) from which point-to-point links are allocated.
* firstuplink: First interface to use as uplink - e.g. 45 if you wanted to use Eth45-48 inclusive as uplinks in a 4-spine network.
* leafprefix: Hostname prefix for leaves.
* spineprefix: Hostname prefix for spines.

These parameters are used by infra-dm.j2, infra-spine.j2 and infra-leaf.j2.  They generate a file in output/infra-$HOSTNAME.yml.  This is then read back in by the playbook and used by infra-config.j2 to generate output/infra-$HOSTNAME-config.txt.

Some basic validation of the data model takes place using assertions too.  Jumped the gun a bit there...

## Services

The service model is simpler, but does draw a few parameters frome the Infrastructure DM and hostvars.  The input YML file service-dm.yml defines, tenants (i.e. VRFs), VLANs (used for SVIs as well as L2 definition), and which ports are on which network.  Where possible, VLANs are referred to by name not ID.  The Jinja2 template service-dm.j2 is used to create config directly for the VLANs, SVIs, VRFs and VXLAN VNI-VLAN mappings.  Because basic head-end-replication is being used, the vtep flood list needs the IPs of all leaves, apart from the current leaf.  This is grabbed from hostvars but is done with a loop - I'm sure there's an easier way but I'm stuggling to see it!